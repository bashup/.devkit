#!/usr/bin/env bash

# Use cram and watch for testing, and provide a shell console
dk use: cram reflex-watch shell-console bash32 shellcheck

on boot require mdsh           github bashup/mdsh      master bin/mdsh
on boot require loco           github bashup/loco      master bin/loco
on boot require realpaths      github bashup/realpaths master realpaths
on boot require bashup.events  github bashup/events    master bashup.events

on build mdsh --out dk --compile dk.md
on build chmod +x dk

unwatch dk '**/.~*.md' '**/*.err'
watch+ -- dk build

# Auto-build dk and re-exec it if needed
if [[ ! -x dk || dk.md -nt dk ]]; then
    on build exec "./dk" ${LOCO_ARGS[@]+"${LOCO_ARGS[@]}"}
    dk build
fi

# SC1090 = dynamic 'source' command
# SC2016 = expressions in single quotes
# SC2145 = prefix or suffix on "$@" or other array
SHELLCHECK_OPTS='-x -e SC1090,SC2016,SC2145'

on test dk shellcheck modules/*
