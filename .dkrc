#!/usr/bin/env bash

# Use cram and watch for testing, and provide a shell console
dk use: cram entr-watch shell-console

dk.rebuild() {
    require mdsh basher install bashup/mdsh
    REPLY=$(mdsh --compile dk.md) || abort "compile failed w/code $?" $?
    echo "$REPLY" >./dk
    chmod +x ./dk
}

# Auto-build dk and re-exec it if needed
if [[ ! -x dk || dk.md -nt dk ]]; then
    dk.rebuild
    exec "./dk" "${LOCO_ARGS[@]}"
fi
